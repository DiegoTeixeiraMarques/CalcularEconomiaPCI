<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE-edge">
        <meta name="viewport" content="width=device-width, user-scalable=no">
        <title>Calculadora de PCI</title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" 
            integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    </head>
    <body>
        <!---------------------  INICIO CONTAINER     ------------------------>
        <div class="container-fluid" style="padding-left: 50px; padding-right: 50px; padding-top: 30px; background-color: rgba(0, 0, 0, 0.952);">
        <!---------------------    1ª LINHA   ------------------------>
            <div class="row">

                <div class="col-12" style="border-radius: 10px; background-color: green">
                    <h4 align="center" style="padding: 5px; color:white">COMPARAÇÃO CUSTO DE PODER CALORÍFICO</h4> 
                </div>

            </div>

            </br>

            <div class="row">

                <div class="col-sm-3" style="background-color:  rgb(255, 255, 255); border-radius: 10px; margin: 5px; margin-left: 30px">
                    <div class="row" style="margin: 20px">
                        
                        <h5>COMBUSTÍVEIS USIBRAS</h5>

                    </div>

                    <div class="row" style="margin: 20px">
                        
                        <select id="combUsibras" class="form-control">
                            <option value="0" selected disabled hidden>Escolha uma opção</option>
                            <option value="4700">PELLET USIBRAS</option>
                            <option value="4900">LCC USIBRAS</option>
                            <option value="4700">CASCA CAJU USIBRAS</option>
                        </select>

                    </div>

                        
                    <div class="row" style="margin: 20px">
                        <h5>PREÇO POR KG</h5>
                    </div>

                    <div class="row" style="margin: 20px">
                        <input id="precoUsibras" type="number" value="" class="form-control" placeholder="Informe o preço"/>
                    </div>

                    <div class="row" style="margin: 20px">
                        <h5>PODER CALORÍFICO</h5>
                    </div>

                    <div class="row" style="margin: 20px">
                        <h3><span id="pciUsibras" class="badge badge-secondary"/>...</h3>
                    </div>

                    <div class="row" style="margin: 20px">
                        <h5>PREÇO UNITÁRIO</h5>
                    </div>

                    <div class="row" style="margin: 20px">
                        <h3><span id="precoUnitUsibras" class="badge badge-secondary"/>...</h3>
                    </div>

                </div>

                
                <div class="col-sm-3" style="background-color: rgb(255, 255, 255); border-radius: 10px; margin: 5px; margin-left: 30px">
                    <div class="row" style="margin: 20px">
                        
                        <h5>OUTROS COMBUSTÍVEIS</h5>

                    </div>

                    <div class="row" style="margin: 20px">
                        
                        <select id="combOutros" class="form-control">
                            <option value="0" selected disabled hidden>Escolha uma opção</option>
                            <option value="6300">APARAS VINILO</option>

                            <option value="3200">BAGAÇO DE CANA (20% ÁGUA)</option>
                            <option value="1800">BAGAÇO DE CANA (50% ÁGUA)</option>
                            <option value="3700">BAMBÚ (10% ÁGUA)</option>
                            <option value="1570">BORRA DE CAFÉ</option>

                            <option value="7000">CARVÃO DE BABAÚ</option>
                            <option value="6200">CARVÃO MINERAL - CAMBUI/PR</option>
                            <option value="3100">CARVÃO MINERAL - CHARQUEADAS/RS</option>
                            <option value="4200">CARVÃO MINERAL - MINA DO LEÃO/RS</option>
                            <option value="4500">CARVÃO MINERAL - TUBARÃO/SC</option>
                            <option value="7500">CARVÃO VEGETAL</option>
                            <option value="2200">CASCA DE ÁRVORE</option>
                            <option value="3000">CASCA DE ALGODÃO</option>
                            <option value="4800">CASCA DE AMÊNDOA DENDÊ</option>
                            <option value="3300">CASCA DE ARROZ (20% ÁGUA)</option>
                            <option value="4000">CASCA DE BABAÇÚ</option>
                            <option value="3900">CASCA DE CACAU (8% ÁGUA)</option>
                            <option value="3800">CASCA DE CAFÉ</option>
                            <option value="4000">CASCA DE CÔCO</option>
                            <option value="3750">CASCA DE EUCALIPTO</option>
                            <option value="800">CASCA DE TANINO ÚMIDO (68% ÁGUA)</option>
                            <option value="3300">CASCA DE SOJA</option>

                            <option value="9800">OLEO COMBUSTIVEL 1A</option>
                            <option value="9800">OLEO COMBUSTIVEL 1B</option>
                            <option value="9000">OLEO COMBUSTIVEL 2A</option>
                            <option value="9000">OLEO COMBUSTIVEL 2B</option>
                            <option value="3000">OLEO COMBUSTIVEL 3A</option>
                            <option value="9000">OLEO COMBUSTIVEL 3B</option>

                        </select>

                    </div>
                        
                    <div class="row" style="margin: 20px">
                        <h5>PREÇO POR KG</h5>
                    </div>

                    <div class="row" style="margin: 20px">
                        <input id="precoOutros" type="number" value="" class="form-control" placeholder="Informe o preço"/>
                    </div>

                    <div class="row" style="margin: 20px">
                        <h5>PODER CALORÍFICO</h5>
                    </div>

                    <div class="row" style="margin: 20px">
                        <h3><span id="pciOutros" class="badge badge-secondary"/>...</h3>
                    </div>

                    <div class="row" style="margin: 20px">
                        <h5>PREÇO UNITÁRIO</h5>
                    </div>

                    <div class="row" style="margin: 20px">
                        <h3><span id="precoUnitOutros" class="badge badge-secondary"/>...</h3>
                    </div>

                </div>
                
                <div class="col-sm-5" style="background-color: rgb(255, 255, 400); border-radius: 10px; margin: 5px; margin-left: 30px">

            
                    <div class="row" style="margin: 20px">
                        
                        <h5>INFORME O CONSUMO PLANEJADO</h5>

                    </div>

                    
                    <div class="row" style="margin: 20px">
                        <div class="col-sm-6">
                            <input id="consumoPlanejado" type="number" value="" class="form-control" placeholder="0,00"/>
                        </div>
                        
                        <div class="col-sm-6">
                            <div class="radio">
                                <input type="radio" name="radio" id="radio" value="Consumo Diário" checked>
                                <label for="radio">
                                    Consumo Diário
                                </label>
                            </div>
                            <div class="radio">
                                <input type="radio" name="radio" id="radio" value="Consumo Mensal">
                                <label for="radio">
                                    Consumo Mensal
                                </label>
                            </div>
                        </div>

                    </div> 

                    <div class="row" style="margin: 20px">
                        
                        <h5>INFORME O INVESTIMENTO NECESSÁRIO</h5>

                    </div>

                    <div class="row" style="margin: 20px">
                        
                        <div class="col-sm-12">
                            <input id="investimentoNecessario" type="number" value="" class="form-control" placeholder="0,00"/>
                        </div>
                    </div>
                    
                </div>

            </div>

        </div> 
        
        
        <div class="container-fluid" style="padding-left: 50px; padding-right: 50px; padding-top: 30px; background-color: rgba(0, 0, 0, 0.952);">
              
            <div class="row">

                <div class="col-12" style="border-radius: 10px; background-color: green;">
                    <h4 align="center" style="padding: 5px; color:white">ANÁLISE FINANCEIRA</h4> 
                </div>

            </div>

            </br>


            <div class="row">

                <div class="col-sm-6">
                    <div class="col-sm-12" style="background-color: rgb(255, 255, 255); border-radius: 10px">
                        <div class="row" style="margin: 20px">            
                            <div class="col-sm-12">
                                <div class="row" style="margin: 20px" id="graph1">                        
                                    <canvas class="bar-chart"></canvas>                
                                </div>                                 
                            </div>        
                        </div>                           
                    </div>      
                </div>
            
                <div class="col-sm-6">
                    <div class="col-sm-12" style="background-color: rgb(255, 255, 255); border-radius: 10px;">
                        <div class="row" style="margin: 20px;">    
                            <div class="col-sm-12">
                                <div class="row" style="margin: 20px" id="graph2">                        
                                    <canvas class="doughnut-chart"></canvas>                
                                </div>                                 
                            </div>
                        </div>                       
                    </div>
                </div>

                <div class="col-sm-6">
                    <div class="col-sm-12" style="background-color: rgb(255, 255, 255); border-radius: 10px;">
                        <div class="row" style="margin: 20px;">    
                            <div class="col-sm-12">
                                <div class="row" style="margin: 20px" id="graph3">                        
                                    <canvas class="line-chart"></canvas>                
                                </div>                                 
                            </div>
                        </div>                       
                    </div>
                </div>


            </div>

            <div class="row">

                <div class="col-sm-6">
                    <div class="col-sm-12" style="background-color: rgb(255, 255, 255); border-radius: 10px">
                        <div class="row" style="margin: 20px;">
                            <div class="col-sm-6">
                                
                                <div class="row" style="margin: 20px"></div>    
                                                    
                                <h5 align="center">OPÇÃO MAIS ECONÔMICA</h5>                
                                 
                                <div class="row" style="margin: 20px"></div>                              
                                
                                <h3 align="center"><span id="melhorOpcao" class="badge badge-success"/>...</h3>  
                                
                                <div class="row" style="margin: 20px"></div>
                                                                      
                            </div>
                            
                            <div class="col-sm-6">  
                                
                                <div class="row" style="margin: 20px"></div>
                                                   
                                <h5 align="center">PERCENTUAL DE ECONOMIA</h5>                    
                                      
                                <div class="row" style="margin: 20px"></div>

                                <h3 align="center"><span id="percentualEconomia" class="badge badge-success"/>...</h3> 
                                
                                <div class="row" style="margin: 20px"></div>
                                                                       
                            </div>
                        </div>
                        
                        <div class="row" style="margin: 20px;">

                            <div class="col-sm-6 border">    
                                
                                    <h5 align="center" >EQUIVALÊNCIA EM PESO</h5>

                                    <div class="row" style="margin: 20px">                            
                                                                                    
                                    </div>

                                    <h3 align="center"><span id="" class="badge badge-success"/>1 kg</h3>
                                    <h3 align="center"><span id="pesoEquivalenteOutros" class="badge badge-success"/>...</h3>

                                    <div class="row" style="margin: 20px"></div>
                                            
                            </div>

                            <div class="col-sm-6 border">    
                                
                                    <h5 align="center" >EQUIVALÊNCIA EM CUSTO</h5>

                                    <div class="row" style="margin: 20px">                            
                                                                                    
                                    </div>

                                    <h3 align="center"><span id="percentualEconomia" class="badge badge-success"/>...</h3>

                                    <div class="row" style="margin: 20px"></div>
                                            
                            </div>
                        </div>   
                    </div>         
                </div>

                <div class="col-sm-6">
                    <div class="col-sm-12" style="background-color: rgb(255, 255, 255); border-radius: 10px">
                        <div class="row" style="margin: 20px">                
                            <div class="col-sm-6">
                                                             
                            </div>        
                        </div>   
                    </div>             
                </div>
            </div>

        </div>

        <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha256-pasqAKBDmFT4eHoN2ndd6lN370kFiGUFyTiUHWhU7k8=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.bundle.js" integrity="sha256-qSIshlknROr4J8GMHRlW3fGKrPki733tLq+qeMCR05Q=" crossorigin="anonymous"></script>


    <script>
 
        $("#combUsibras").change(function(){           calc1();        });
        $("#precoUsibras").change(function(){          calc1();        });
        $("#combOutros").change(function(){            calc2();        });
        $("#precoOutros").change(function(){           calc2();        });
        $("#consumoPlanejado").change(function(){      calcPercentual();        });
        $("#investimentoNecessario").change(function(){      calcPercentual();        });

        function calc1(){
            var pciUsibras = $("#combUsibras").val();
            var precoUsibras = $("#precoUsibras").val();
            var precoUnitUsibras = (precoUsibras / pciUsibras).toFixed(5);
            $("#pciUsibras").html(pciUsibras + " Kcal/Kg");
            $("#precoUnitUsibras").html("R$ " + precoUnitUsibras);
            calcPercentual();
        }

        function calc2(){
            var pciOutros = $("#combOutros").val();
            var precoOutros = $("#precoOutros").val();
            var precoUnitOutros = (precoOutros / pciOutros).toFixed(5);
            $("#pciOutros").html(pciOutros + " Kcal/kg");
            $("#precoUnitOutros").html("R$ " + precoUnitOutros);
            calcPercentual();
        }

        function calcPercentual(){
            var combUsibras = $("#combUsibras :selected").text();
            var pciUsibras = $("#combUsibras").val();
            var precoUsibras = $("#precoUsibras").val();
            var precoUnitUsibras = (precoUsibras / pciUsibras).toFixed(5);

            var combOutros = $("#combOutros :selected").text();
            var pciOutros = $("#combOutros").val();
            var precoOutros = $("#precoOutros").val();
            var precoUnitOutros = (precoOutros / pciOutros).toFixed(5);

            var percentual = 0;
            var pesoEquivalenteUsibras = 0;
            var pesoEquivalenteOutros = 0;
            var proporcaoTotalKgUsibras = 0;
            var proporcaoTotalKgOutros = 0;
            var precoTotalEquivalenteUsibras = 0;
            var precoTotalEquivalenteOutros = 0;
            var economiaTotal = 0;
            var tempoRetornoInvestimento = 0;

            var consumoPlanejado = $("#consumoPlanejado").val();
            var investimentoNecessario = $("#investimentoNecessario").val();
            var periodicidadeConsumo = $("input[name='radio']:checked").val();

            console.log(periodicidadeConsumo);

            if(combUsibras != "" && combOutros != "" && precoUsibras != "" && precoOutros != ""){
                // Calcula o percentual entre o menor e o maior custo por PCI
                if(precoUnitUsibras < precoUnitOutros)
                    percentual = (((precoUnitUsibras / precoUnitOutros) - 1) * 100) * -1;
                else if (precoUnitUsibras > precoUnitOutros)
                    percentual = (((precoUnitOutros / precoUnitUsibras) - 1) * 100) * -1;
                else
                    percentual = 0;
                $("#percentualEconomia").html(percentual.toFixed(0) + "% mais econômico" );


                // Verifica qual melhor opção entre os insumos
                if(precoUnitUsibras < precoUnitOutros)
                    $("#melhorOpcao").html(combUsibras);
                else if (precoUnitUsibras > precoUnitOutros)
                    $("#melhorOpcao").html(combOutros);
                else 
                    $("#melhorOpcao").html("...");


                // Calcula equivalência por peso
                if((pciUsibras - pciOutros) < 0){
                    pesoEquivalenteUsibras = ((pciOutros - pciUsibras) / pciUsibras) + 1;
                    pesoEquivalenteOutros = 1;
                } else {
                    pesoEquivalenteOutros = ((pciUsibras - pciOutros) / pciUsibras) + 1;
                    pesoEquivalenteUsibras = 1;
                }

                console.log("Peso equivalente Usibras: " + pesoEquivalenteUsibras.toFixed(2));
                console.log("Peso equivalente Outros: " + pesoEquivalenteOutros.toFixed(2));
        
                proporcaoTotalKgUsibras = consumoPlanejado * pesoEquivalenteUsibras;
                proporcaoTotalKgOutros = consumoPlanejado * pesoEquivalenteOutros;
                console.log("Consumo planejado Usibras: " + proporcaoTotalKgUsibras.toFixed(2));
                console.log("Consumo planejado Outros: " + proporcaoTotalKgOutros.toFixed(2));

                // Calcula equivalência por preço
                precoTotalEquivalenteUsibras = proporcaoTotalKgUsibras * precoUsibras;
                precoTotalEquivalenteOutros = proporcaoTotalKgOutros * precoOutros;
               
                if(precoTotalEquivalenteUsibras < precoTotalEquivalenteOutros){
                    economiaTotal = precoTotalEquivalenteOutros - precoTotalEquivalenteUsibras;
                } else if(precoTotalEquivalenteOutros < precoTotalEquivalenteUsibras){
                    economiaTotal = 0;
                }

                console.log("Preco total Usibras: " + precoTotalEquivalenteUsibras.toFixed(2));
                console.log("Preco total Outros: " + precoTotalEquivalenteOutros.toFixed(2));
                console.log("Economia total: " + economiaTotal.toFixed(2));

                console.log(investimentoNecessario);
                if(economiaTotal == 0 && investimentoNecessario > 0 && consumoPlanejado > 0){
                    tempoRetornoInvestimento = "Não retorna";
                } else
                    tempoRetornoInvestimento = investimentoNecessario / economiaTotal;

                console.log("Retorno do investimento em:  " + tempoRetornoInvestimento);

                atualizarGraficos(economiaTotal, precoTotalEquivalenteUsibras, precoTotalEquivalenteOutros);
            }

        }

        var ctx1 = document.getElementsByClassName("bar-chart");
        var ctx2 = document.getElementsByClassName("doughnut-chart");
        var ctx3 = document.getElementsByClassName("line-chart");

        function atualizarGraficos(economiaTotal, precoTotalEquivalenteUsibras, precoTotalEquivalenteOutros){
            var combUsibras = $("#combUsibras :selected").text();
            var pciUsibras = $("#combUsibras").val();
            var precoUsibras = $("#precoUsibras").val();
            var precoUnitUsibras = (precoUsibras / pciUsibras).toFixed(5);

            var combOutros = $("#combOutros :selected").text();
            var pciOutros = $("#combOutros").val();
            var precoOutros = $("#precoOutros").val();
            var precoUnitOutros = (precoOutros / pciOutros).toFixed(5);

            var precoTotalEquivalenteUsibras = precoTotalEquivalenteUsibras;
            var precoTotalEquivalenteOutros = precoTotalEquivalenteOutros;
            var economiaTotal = economiaTotal;
            var periodicidadeConsumo = $("input[name='radio']:checked").val();
            var dataSetGraficoLinha = {};

            document.getElementById("graph1").innerHTML = '&nbsp;';
            document.getElementById("graph1").innerHTML = '<canvas class="bar-chart" width= "3000" height="1000"></canvas>';

            document.getElementById("graph2").innerHTML = '&nbsp;';
            document.getElementById("graph2").innerHTML = '<canvas class="doughnut-chart"></canvas>';

            document.getElementById("graph3").innerHTML = '&nbsp;';
            document.getElementById("graph3").innerHTML = '<canvas class="line-chart"></canvas>';

            var chartGraphBar = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: [combUsibras, combOutros],
                    datasets: [{
                        data: [precoUnitUsibras, precoUnitOutros],
                        borderWidth: 2,
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(75, 192, 192, 1)',
                        ],
                        backgroundColor: [                                
                            'rgba(255, 99, 132, 0.8)',                             
                            'rgba(75, 192, 192, 0.8)',
                        ],
                    }],
                },
                options: {
                    title: {
                        display: true,
                        fontSize: 16,
                        text: "Custo por unidade de Poder Calorífico"
                    },
                    legend: {
                        display: false,
                    },
                    scales: {
                        xAxes: [{
                        stacked: true
                    }]}
                },

            });

            var chartGraphDoughnut = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: [combUsibras, combOutros],
                    datasets: [{
                        labels: "",
                        data: [pciUsibras, pciOutros],
                        borderWidth: 2,
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(75, 192, 192, 1)',
                        ],   
                        backgroundColor: [                                
                            'rgba(255, 99, 132, 0.8)',                             
                            'rgba(75, 192, 192, 0.8)',
                        ],
                    }],
                },
                options: {
                    title: {
                        display: true,
                        fontSize: 16,
                        text: "Quantidade de Poder Calorífico por KG"
                    },
                    legend: {
                        display: true,
                        position: 'bottom',
                        fullWidth: true,     
                    }
                }
            });

            // Verifica a periodicidade e produz o dataset
            if (periodicidadeConsumo == "Consumo Diário"){

                A = [];
                B = [];
                C = [];
                D = "Custo diário durante um ano"

                for (var i = 0; i < 366; i++){
                    A[i] = i * precoTotalEquivalenteUsibras.toFixed(2);
                    B[i] = i * precoTotalEquivalenteOutros.toFixed(2);
                    C[i] = i;
                }

                dataSetGraficoLinha = [{ 
                            data: A,
                            label: combUsibras,
                            borderColor: "#3e95cd",
                            fill: false
                        }, { 
                            data: B,
                            label: combOutros,
                            borderColor: "#8e5ea2",
                            fill: false
                        }
                        ];
            } else {
                A = [];
                B = [];
                C = [];
                D = "Custo mensal durante três anos"

                for (var i = 0; i < 36; i++){
                    A[i] = i * precoTotalEquivalenteUsibras.toFixed(2);
                    B[i] = i * precoTotalEquivalenteOutros.toFixed(2);
                    C[i] = i;
                }

                dataSetGraficoLinha = [{ 
                            data: A,
                            label: combUsibras,
                            borderColor: "#3e95cd",
                            fill: false
                        }, { 
                            data: B,
                            label: combOutros,
                            borderColor: "#8e5ea2",
                            fill: false
                        }
                        ];

            }

            var chartGraphLine = new Chart(ctx3, {
                type: 'line',
                data: {
                    labels: C,
                    datasets: dataSetGraficoLinha,
                },
                options: {
                    title: {
                        display: true,
                        fontSize: 16,
                        text: D
                    },
                }

            });
        }
    </script>
    </body>
</html>